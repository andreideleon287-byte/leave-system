<!DOCTYPE html>
<html>
<head>
    <title>Luo City Spa | Master Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root { --forest: #228B22; --pending: #ff9800; --approved: #2e7d32; --rejected: #d32f2f; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f2; margin: 0; }
        
        /* Security Overlay */
        .login-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--forest); display: flex; align-items: center; justify-content: center; z-index: 1000; 
        }
        .login-card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); width: 320px; text-align: center; }
        
        /* Dashboard Layout */
        #adminContent { display: none; padding: 15px; max-width: 1000px; margin: auto; }
        .header { background: var(--forest); color: white; padding: 20px; text-align: center; border-radius: 12px 12px 0 0; }
        
        /* Stats Bar */
        .stats-bar { display: flex; gap: 10px; margin: 15px 0; }
        .stat-card { flex: 1; background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-card h2 { margin: 5px 0 0; font-size: 24px; }
        
        /* Tabs */
        .tab-container { display: flex; background: #333; border-radius: 0 0 0 0; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; color: #bbb; font-weight: bold; }
        .tab.active { background: #444; color: white; border-bottom: 4px solid var(--forest); }
        
        /* Sections */
        .section { display: none; background: white; padding: 20px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .section.active { display: block; }
        
        /* UI Elements */
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        td, th { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .badge { padding: 4px 8px; border-radius: 10px; font-size: 11px; font-weight: bold; color: white; }
        .bg-Pending { background: var(--pending); }
        .bg-Approved { background: var(--approved); }
        .bg-Disapproved { background: var(--rejected); }
        .btn-del { color: var(--rejected); border: 1px solid var(--rejected); background: none; padding: 5px 10px; border-radius: 6px; cursor: pointer; }
        .staff-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div id="adminLogin" class="login-overlay">
    <div class="login-card">
        <h2 style="color:var(--forest);">LCS ADMIN</h2>
        <input type="text" id="adminUser" placeholder="Username">
        <input type="password" id="adminPass" placeholder="Password">
        <button onclick="checkLogin()" style="width:100%; padding:12px; background:var(--forest); color:white; border:none; border-radius:8px; cursor:pointer;">ENTER DASHBOARD</button>
        <p id="loginErr" style="color:red; font-size:12px; margin-top:10px;"></p>
    </div>
</div>

<div id="adminContent">
    <div class="header">
        <h2 style="margin:0;">LUO CITY SPA COMMAND</h2>
    </div>

    <div class="stats-bar">
        <div class="stat-card" style="border-bottom: 4px solid var(--approved);">
            <small>APPROVED</small><h2 id="sApp">0</h2>
        </div>
        <div class="stat-card" style="border-bottom: 4px solid var(--pending);">
            <small>PENDING</small><h2 id="sPen">0</h2>
        </div>
        <div class="stat-card" style="border-bottom: 4px solid var(--forest);">
            <small>TOTAL STAFF</small><h2 id="sStaff">0</h2>
        </div>
    </div>

    <div class="tab-container">
        <div class="tab active" id="tL" onclick="showTab('leaves')">LEAVE LIST</div>
        <div class="tab" id="tS" onclick="showTab('staff')">MANAGE STAFF</div>
    </div>

    <div id="secL" class="section active">
        <input type="text" id="search" onkeyup="filter()" placeholder="Search names or status...">
        <div id="leaveTable">Loading...</div>
    </div>

    <div id="secS" class="section">
        <h3>Authorize New Staff</h3>
        <input type="text" id="nName" placeholder="Full Name">
        <input type="text" id="nId" placeholder="Employee ID">
        <button onclick="addStaff()" style="width:100%; padding:12px; background:var(--forest); color:white; border:none; border-radius:8px;">ADD TO SYSTEM</button>
        <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
        <h3>Current Access List</h3>
        <div id="staffList"></div>
    </div>
</div>

<script>
    const scriptURL = 'YOUR_APPS_SCRIPT_URL_HERE'; 
    const CREDENTIALS = { u: "admin", p: "LuoCity2026" };

    function checkLogin() {
        const u = document.getElementById('adminUser').value;
        const p = document.getElementById('adminPass').value;
        if(u === CREDENTIALS.u && p === CREDENTIALS.p) {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            refreshData();
        } else {
            document.getElementById('loginErr').innerText = "Wrong credentials";
        }
    }

    function showTab(type) {
        document.getElementById('secL').classList.toggle('active', type === 'leaves');
        document.getElementById('secS').classList.toggle('active', type === 'staff');
        document.getElementById('tL').classList.toggle('active', type === 'leaves');
        document.getElementById('tS').classList.toggle('active', type === 'staff');
        refreshData();
    }

    function refreshData() {
        fetch(scriptURL + "?action=getAllData").then(r => r.json()).then(data => {
            let app = 0, pen = 0, html = '<table><tr><th>Staff</th><th>Status</th><th>Action</th></tr>';
            data.reverse().forEach(r => {
                if(r.status === "Approved") app++;
                if(r.status === "Pending") pen++;
                html += `<tr><td><strong>${r.name}</strong><br><small>${r.dates}</small></td>
                        <td><span class="badge bg-${r.status}">${r.status}</span></td>
                        <td><button class="btn-del" onclick="delRow(${r.row})">Del</button></td></tr>`;
            });
            document.getElementById('sApp').innerText = app;
            document.getElementById('sPen').innerText = pen;
            document.getElementById('leaveTable').innerHTML = html + '</table>';
        });

        fetch(scriptURL + "?action=getStaffList").then(r => r.json()).then(data => {
            document.getElementById('sStaff').innerText = data.length;
            let html = '';
            data.forEach(s => {
                html += `<div class="staff-item">
                    <span><strong>${s.name}</strong> (${s.id})</span>
                    <button class="btn-del" onclick="delStaff(${s.row})">Remove</button>
                </div>`;
            });
            document.getElementById('staffList').innerHTML = html;
        });
    }

    function addStaff() {
        let pin = prompt("Enter Master PIN:");
        let fd = new FormData();
        fd.append('action', 'addStaff');
        fd.append('staffName', document.getElementById('nName').value);
        fd.append('staffId', document.getElementById('nId').value);
        fd.append('pin', pin);
        fetch(scriptURL, {method:'POST', body:fd}).then(() => refreshData());
    }

    function delRow(row) {
        let pin = prompt("Enter Master PIN to Delete:");
        let fd = new FormData();
        fd.append('action', 'deleteRow');
        fd.append('row', row);
        fd.append('pin', pin);
        fetch(scriptURL, {method:'POST', body:fd}).then(() => refreshData());
    }

    function delStaff(row) {
        let pin = prompt("Enter Master PIN to Remove Staff:");
        let fd = new FormData();
        fd.append('action', 'deleteStaff');
        fd.append('row', row);
        fd.append('pin', pin);
        fetch(scriptURL, {method:'POST', body:fd}).then(() => refreshData());
    }

    function filter() {
        let val = document.getElementById('search').value.toUpperCase();
        let rows = document.querySelectorAll('table tr');
        rows.forEach((r, i) => { if(i>0) r.style.display = r.innerText.toUpperCase().includes(val) ? '' : 'none'; });
    }
</script>
</body>
</html>